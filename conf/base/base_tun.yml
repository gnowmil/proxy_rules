mixed-port: 7897
allow-lan: true
bind-address: "*"
log-level: info
external-controller: 0.0.0.0:9090
external-ui: /etc/mihomo/ui
secret: ''

unified-delay: true
tcp-concurrent: true

upnp:
  enable: true
  listen-port: 7895
  gateway: 10.0.0.1

tun:
  enable: true
  stack: system
  device: mihomo
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  strict-route: true
  # 如果有使用zerotier或者headscale等，需要自己配置排除自己的网段
  # route-exclude-address: ["10.144.144.0/24"]
  # 打开nat1，官方文档说可能会损失一些性能，如果没有nat1需求，可以关闭
  endpoint-independent-nat: true

hosts:
  dns.alidns.com: [223.5.5.5, 223.6.6.6, 2400:3200::1, 2400:3200:baba::1]
  doh.pub: [1.12.12.12, 1.12.12.21, 120.53.53.53]
  dns.google: [8.8.8.8, 8.8.4.4, 2001:4860:4860::8888, 2001:4860:4860::8844]
  cloudflare-dns.com: [1.1.1.1, 1.0.0.1, 2606:4700:4700::1111, 2606:4700:4700::1001]

dns:
  enable: true
  cache-size: 4194304
  min-ttl: 300
  max-ttl: 3600
  listen: 0.0.0.0:5353
  ipv6: false
  prefer-h3: true
  respect-rules: true
  enhanced-mode: fake-ip
  use-hosts: true
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 1.1.1.1
    - 8.8.8.8
  nameserver:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn,apple-cn,google-cn,microsoft-cn,games-cn,private":
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
    - +.stun.*.*
    - +.stun.*.*.*
    - +.stun.*.*.*.*
    - +.stun.*.*.*.*.*
    - 'geosite:fakeip-filter,cn'
  fallback:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      # 如果嗅探出的域名與原始請求的 IP 不符，強制使用嗅探出的域名來匹配規則。
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

geodata-mode: true
geox-url:
  geoip: "https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-geodata/geoip.dat"
  geosite: "https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-geodata/geosite-all.dat"
  mmdb: "https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-geodata/Country.mmdb"
  asn: "https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-geodata/Country-ASN.mmdb"
geo-auto-update: true
geo-update-interval: 24

proxies:
  # - name: "Placeholder"
  #   type: direct

proxy-groups:
  # - name: "PROXY"
  #   type: select
  #   proxies:
  #     - "Placeholder"

rules:
  # - MATCH,PROXY